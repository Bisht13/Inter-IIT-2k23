![Metamask Logo](https://docs.metamask.io/metamask-fox.svg)
<br>
# Inter IIT Tech 11.0

**Midprep
<br>
Consensys: Metamask Snaps Problem Statement Submission**
<br>
Primary Team ID:
<br>
Secondary Team ID:
___


**Table of Contents** 

- [Inter IIT Tech 11.0](#inter-iit-tech-110)
    - [Table of Contents](#table-of-contents)
  - [Introduction](#introduction)
    - [1. Two Factor Authentication (2FA) Snap](#1-two-factor-authentication-2fa-snap)
    - [2. Staking/ Unstaking Snap](#2-staking-unstaking-snap)
    - [3. Transaction Summary Snap](#3-transaction-summary-snap)
    - [4. Smart Contract Wallet Snap](#4-smart-contract-wallet-snap)
    - [5. Multi-sig Wallet Snap](#5-multi-sig-wallet-snap)
    - [6. Transaction Simulation Snap](#6-transaction-simulation-snap)
    - [7. Smart Contract Approval/Revoke Snap](#7-smart-contract-approvalrevoke-snap)
    - [8. Impersonation Snap](#8-impersonation-snap)
  - [Challenges we ran into](#challenges-we-ran-into)
  - [Setup](#setup)


___


### 1. Two Factor Authentication (2FA) Snap

&nbsp;&nbsp;&nbsp;&nbsp;This snap brings an additional layer of security to Metamask. The user gets a time based one time password (TOTP) on his favorite Authenticator mobile app on initiating a transaction. The transaction can only be signed upon providing the correct TOTP. A secret is generated using an one-way function and is passed on to generate the TOTP. A time-based one-time password (TOTP) is a temporary passcode generated by an algorithm that uses the current time of day as one of its authentication factors.This TOTP is same accross all the authenticator apps and the user can use any authenticator mobile application of his choice to genrate the TOTP. The snap uses onTransaction method to prompts for the TOTP using the *snap_dialogue* method when a transaction is initiated, and once the user provides the correct TOTP, the transaction succeeds.
<br>
<br>
![](https://i.imgur.com/Bsf2hFH.png)
___
### 2. Staking/ Unstaking Snap
&nbsp;&nbsp;&nbsp;&nbsp;This snap allows the users to stake the desired amount of assets to defi protocols such as AAVE and Compound in a set interval of time. The user can also redeem their supplied assets with the help of the ‘unstake’ functionality. This snap uses the onCronjob method to perform the required task periodically.
<br>
<br>
![staking](https://i.imgur.com/Zxa8FCu.png)



___
### 3. Transaction Summary Snap
&nbsp;&nbsp;&nbsp;&nbsp;A malicious dapp can misguide users with its front end. For example, a buy button can withdraw all funds. In such a situation, the transaction snap will give a summary of the exact details of what the transaction will do with the user’s funds. As the name suggests, it shows the entire transaction summary of the upcoming transaction before signing the actual transaction.This snap provides the user with an AI generated summary for the transaction they are currently performing. This snap provides the contract source code and the function the user is interacting with OpenAI's GPT engine, that generates an user-friendly insight for the ongoing transaction.
___
### 4. Smart Contract Wallet Snap
&nbsp;&nbsp;&nbsp;&nbsp; Smart Contract wallets are the wallets that control funds through code unlike Private Key as is the case with Externally Owned Accounts (EOAs). We have deployed a factory contract with all the basic functionalities. The smart contract account has a modular structure that allows the user to add a module of feature of his own choice. Some of the modules that we have added to the contract are - Role based multiple auths, Whitelisting smart contracts , MEV resistant swapping of tokens.
* **Multiple auths** - The owner becomes the master owner and can add multiple auths to handle his transactions using a role based system. Also, if an auth looses his rights, the other auths have the power to help him regain it.
* **Whitelisting** - The smart contract wallet allows user to whitelist specific contracts, that he might want to interact.
* **MEV Resistant Swap** - This feature allows the user to perform token swaps, using a aggregator consisting of various DeFi protocols such as Uniswap V2, Paraswap, 1Inch and ZEROEX. The swaps are MEV resistant, as we are calculating the output amount off-chain and comparing it with the expected amount and incase the amount we are recieving is less than that of the calculated one, the transaction reverts and prevents the user from being front-runned.
* **Batch Transaction** - If the user wants to execute many transactions but does not have enough gas fees to do so. Then batch transaction comes in where the user can batch/compile many transactions into one and execute all by paying the gas fees for just one transaction. A perfect example of this is leveraging which includes supplying, borrowing and then again supplying. All these transactions are done as a single batched transaction which helps users to save gas fees.
___
### 5. Multi-sig Wallet Snap
&nbsp;&nbsp;&nbsp;&nbsp;**Multi-sig Wallets** refer to smart contract wallets having multiple owners and a number of threshold signatures required to execute a transaction. In this snap, we have applied the **Gnosis Safe**‘s implementation of multi-sig wallet.

There are various ways in which multi-sig wallets are better than a hot wallet:
1. In case of a hot wallet, when the user’s private key is compromised, his funds are not safe anymore. The attacker can at any moment steal the user’s fund and there is nothing the user can do. But with multi-sig wallet, the attacker can not initiate any transaction from the smart contract account, without the required number of signatures.
2. With multi-sig wallets, the owner can any time check the balances which is not the case with hardware wallets with the same level of security.
3. The risk of interacting with malicious contracts is now much lower, as making mistakes as an individual is quite possible but, it is very unlikely that a group of people make a mistake.
<br>
<br>

![](/multi-sig.png)

___

#### Implementation
The following flow diagram shows our implementation of multi-sig wallet using metamask snap:
<br>
<br>
![safe](https://i.imgur.com/nUikv5I.png)


___
### 6. Transaction Simulation Snap
&nbsp;&nbsp;&nbsp;&nbsp;This snap enables the user to simulate the initiated transaction (using Tenderly.co’s API) before signing. In case the transaction is going to fail, the user gets an idea beforehand about the failure and the errors that the transaction may encounter. If the transaction is going to succeed, the user gets a track of his funds.
<br>
![Simulation](https://i.imgur.com/R396VE8.png)


___
### 7. Smart Contract Approval/Revoke Snap
&nbsp;&nbsp;&nbsp;&nbsp;This snap allows the user to fetch a list of his approved smart contracts for various ERC20 tokens. This snap also allows users to revoke approval to any spender smart contract that was approved earlier.

___
### 8. Impersonation Snap
&nbsp;&nbsp;&nbsp;&nbsp;There are scenarios when users want to look for someone else's address positions on snap to get an idea of which and how much assets are being holder by that address. This snap allows the user to view the position of any other user’s address in DeFi protocols like AAVE, Compound etc.
___

## Challenges we ran into
* 
* we faced challenge 2
* we faced challenge 3
* we faced challenge 

## Setup

The project setups are as follows:

1. Install all the dependencies:
```
yarn install
```
2. Start the localhost server:
```
yarn start
```

Go to http://localhost:8080 to see the test app.


